<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo Notes Tracker</title>
    <link rel="stylesheet" href="styles.css" />
    
    <!-- Load preferences immediately to prevent flash -->
    <script>
        // This script runs synchronously before body renders to prevent FOUC (Flash of Unstyled Content)
        (async function() {
            try {
                // Wait for Tauri to be ready
                if (window.__TAURI__) {
                    const { invoke } = window.__TAURI__.core;
                    
                    // Load preferences in parallel
                    const [darkMode, zoomLevel] = await Promise.all([
                        invoke('load_dark_mode_preference').catch(() => false),
                        invoke('load_zoom_preference').catch(() => 1.0)
                    ]);
                    
                    // Apply dark mode immediately
                    if (darkMode) {
                        document.documentElement.classList.add('dark-mode');
                    }
                    
                    // Apply zoom immediately
                    document.documentElement.style.setProperty('--zoom-scale', zoomLevel);
                }
            } catch (error) {
                console.error('Failed to load initial preferences:', error);
                // Continue with defaults - no flash since we haven't rendered yet
            }
        })();
    </script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1 id="current-date">Today</h1>
            <div class="header-controls">
                <div class="nav-group">
                    <button id="prev-day" class="nav-button" title="Previous day">‚Üê</button>
                    <button id="today" class="nav-button" title="Go to today">Today</button>
                    <button id="next-day" class="nav-button" title="Next day">‚Üí</button>
                </div>
                <div class="zoom-controls">
                    <button id="zoom-out" class="zoom-button" title="Decrease text size (Cmd/Ctrl + -)">‚àí</button>
                    <span id="zoom-level">100%</span>
                    <button id="zoom-in" class="zoom-button" title="Increase text size (Cmd/Ctrl + +)">+</button>
                    <button id="zoom-reset" class="zoom-button" title="Reset text size (Cmd/Ctrl + 0)">Reset</button>
                </div>
                <div class="theme-controls">
                    <button id="dark-mode-toggle" class="theme-toggle-button" title="Switch to dark mode" aria-label="Dark mode" role="switch" aria-checked="false">üåô</button>
                </div>
                <div class="layout-controls">
                    <button id="reset-panels" class="reset-button" title="Reset panel sizes">Reset Layout</button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Calendar Pane -->
            <div class="calendar-pane" id="calendar-pane">
                <div class="pane-header">
                    <h2>Calendar</h2>
                    <button id="toggle-calendar" class="toggle-btn" title="Hide calendar">‚àí</button>
                </div>
                <div class="calendar-content">
                    <div class="calendar-header">
                        <button id="prev-month" class="calendar-nav-btn" title="Previous month">‚Äπ</button>
                        <h3 id="calendar-month-year">Loading...</h3>
                        <button id="next-month" class="calendar-nav-btn" title="Next month">‚Ä∫</button>
                    </div>
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Calendar will be dynamically generated -->
                    </div>
                </div>
            </div>

            <!-- Resize Handle 1: Between Calendar and Todo -->
            <div class="resize-handle" id="resize-handle-1" data-panels="calendar,todo"></div>

            <!-- Todo List Pane -->
            <div class="todo-pane">
                <div class="pane-header">
                    <h2>Tasks</h2>
                    <div class="pomodoro-controls">
                        <button id="start-pomodoro" class="pomodoro-btn" disabled>
                            üçÖ Start Pomodoro
                        </button>
                        <select id="pomodoro-duration">
                            <option value="25">25 min</option>
                            <option value="20">20 min</option>
                            <option value="15">15 min</option>
                            <option value="5">5 min</option>
                            <option value="1">1 min (test)</option>
                            <option value="10s" selected>10 sec (test)</option>
                        </select>
                    </div>
                </div>

                <div class="todo-list" id="todo-list">
                    <!-- Todo items will be dynamically added here -->
                </div>

                <div class="add-todo">
                    <input type="text" id="new-todo-input" placeholder="Add a new task..." />
                    <button id="add-todo-btn">Add</button>
                </div>
                
                <!-- Custom Modal Dialogs -->
                <div id="custom-modal" class="modal hidden">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="modal-title">Alert</h3>
                        </div>
                        <div class="modal-body">
                            <p id="modal-message">Message</p>
                        </div>
                        <div class="modal-footer">
                            <button id="modal-ok" class="modal-btn modal-btn-primary">OK</button>
                            <button id="modal-cancel" class="modal-btn modal-btn-secondary hidden">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Pomodoro Timer Overlay -->
                <div id="pomodoro-overlay" class="pomodoro-overlay hidden">
                    <div class="timer-display">
                        <div class="timer-task" id="timer-task"></div>
                        <div class="timer-countdown" id="timer-countdown">20:00</div>
                        <div class="timer-controls">
                            <button id="stop-timer" class="timer-btn">Stop Timer</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resize Handle 2: Between Todo and Notes -->
            <div class="resize-handle" id="resize-handle-2" data-panels="todo,notes"></div>

            <!-- Notes Pane -->
            <div class="notes-pane" id="notes-pane">
                <div class="pane-header">
                    <h2>Notes</h2>
                    <button id="toggle-notes" class="toggle-btn" title="Hide notes">‚àí</button>
                </div>
                <textarea id="notes-text" placeholder="Write your notes for today..."></textarea>
            </div>
        </div>
    </div>

    <!-- Version info -->
    <div class="version-info">
        <span id="app-version">v1.1.1</span>
    </div>

    <script src="main.js"></script>
</body>
</html>